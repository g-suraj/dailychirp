async function b(c,t){const e=new TextEncoder().encode(c),s=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(s)).reduce((i,l)=>i*l)%t}async function v(c,t){const e=await b(c,t);console.log(e);let s=[];for(let i=0;i<3;++i)s.push((e+i+1)%t);const n=Math.floor(Math.random()*4);return s.splice(n,0,e),{todaysIndex:e,guesses:s}}const h=new Date().toDateString(),E=document.querySelector(".loaded"),u=document.querySelector(".result"),d=document.querySelector(".bird-image"),A=document.querySelector(".buttons-container"),p=h in localStorage;d?.addEventListener("load",()=>{document.querySelector(".loading")?.setAttribute("style","display: none"),E?.removeAttribute("style")});window.addEventListener("load",async()=>{const t=await(await fetch("https://suraj.fyi/xeno-canto-processed/pickled_data.json")).json(),{todaysIndex:e,guesses:s}=await v(h,t.length),n=t[e],i=e**2%n._pictures.length,l=n._pictures[i];let f=e**3%n._occurrences.length;const g=document.getElementById("main-audio");g?.setAttribute("current",f.toString()),g?.setAttribute("occurrences",JSON.stringify(n._occurrences)),g?.dispatchEvent(new Event("audioLoaded"));const m=document.querySelector(".image-details-container");m&&(m.innerHTML=`Image is courtesy of ${l.rightsHolder}`),d?.setAttribute("src",n._pictures.length?l.src:"https://www.stockvault.net/data/2018/09/18/254636/preview16.jpg"),d?.removeAttribute("hidden"),s.forEach(r=>{const a=document.createElement("div");a.className="button-div",a.innerHTML+=`
          <button
              class="button guess-button"
              value="${r}">${t[r].vernacularName}
          </button>
        `,a.addEventListener("click",()=>{const o={todaysIndex:`${e}`,yourGuess:`${r}`};localStorage.setItem(h,JSON.stringify(o)),y(),d?.setAttribute("style","")}),A?.appendChild(a)}),p&&y(),d?.setAttribute("style",p?"image-rendering: pixelated":"filter: blur(20px) grayscale(100%);");function y(){const r=JSON.parse(localStorage.getItem(h)||"{}"),a=r.todaysIndex==r.yourGuess;a&&window.confetti({particleCount:30,spread:70,origin:{y:.6}}),document.querySelectorAll(".guess-button")?.forEach(o=>{o.getAttribute("value")==r.todaysIndex?o.classList.add("is-success"):o.getAttribute("value")==r.yourGuess&&o.classList.add("is-danger"),o.setAttribute("disabled","")}),u&&(a?u.innerHTML+="<b>That's right</b>!":u.innerHTML+="<b>Tough luck!</b>",u.innerHTML+=`<br>What you hear is a "${t[e].vernacularName}"<br>(<i>${t[e].scientificName}</i>)`,u.innerHTML+=`<br><a class='styled-link' href='https://www.gbif.org/species/${n.speciesKey}'>Click here</a> for more about this bird.`)}});class w extends HTMLElement{credits;current=0;occurrences=[];audio=null;playButton=null;component=null;constructor(){super(),this.style.display="block";const t=this.dataset.message||"error";this.component=document.getElementById(t),this.playButton=this.component?.getElementsByClassName("play").item(0)||null;const e=this.component?.getElementsByClassName("refresh").item(0);this.credits=this.component?.getElementsByClassName("credits-details-container").item(0)||null,this.component?.addEventListener("audioLoaded",()=>{const s={occurrences:JSON.parse(this.component?.attributes.getNamedItem("occurrences")?.value||"[]"),current:0,name:t};this.occurrences=s.occurrences,this.current=s.current,this.setAudio(),this.setCredits()}),this.playButton?.addEventListener("click",()=>{if(this.audio!==null){if(this.audio?.paused){this.audio.play();return}this.audio.pause(),this.audio.currentTime=0}}),e?.addEventListener("click",()=>{if(this.audio===null)return;const s=e.getElementsByTagName("svg")[0].getElementsByTagName("path")[0].getAttribute("d");e.getElementsByTagName("svg")[0].getElementsByTagName("path")[0].setAttribute("d","M4 12a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0"),setTimeout(()=>{e.getElementsByTagName("svg")[0].getElementsByTagName("path")[0].setAttribute("d",s||"")},200),this.current=(this.current+1)%this.occurrences.length,this.setCredits();const n=!this.audio.paused;this.audio.pause(),this.setAudio(),n&&this.audio?.play()})}togglePlayButton(t){this.playButton?.getElementsByTagName("svg")[0].getElementsByTagName("path")[0].setAttribute("d",t?"M14 19V5h4v14zm-8 0V5h4v14z":"M8 5.14v14l11-7z")}setCredits(){this.credits&&(this.credits.innerHTML=`Audio recording is courtesy of
        ${this.occurrences[this.current].__rightsHolder}. (Recording #${this.current+1}
        out of ${this.occurrences.length})`)}setAudio(){this.audio=new Audio(this.occurrences[this.current].__birdsong),this.audio?.addEventListener("play",()=>{this.togglePlayButton(!0)}),this.audio?.addEventListener("pause",()=>{this.togglePlayButton(!1)})}}customElements.define("audio-refresh",w);
